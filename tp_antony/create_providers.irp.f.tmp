BEGIN_SHELL [/usr/bin/python2.7]

import os
doc={}
for filename in os.listdir('.'):
    if filename.endswith('.irp.f'):
        file=open(filename,'r')
        inside_doc=False
        for line in file:
            if line.strip().lower().startswith('begin_provider'):
                name=line.split(',')[1].split(']')[0].strip()
                doc[name]=""
            elif line.strip().lower().startswith('begin_doc'):
                inside_doc=True
            elif line.strip().lower().startswith('end_doc'):
                inside_doc=False
            elif inside_doc:
                doc[name]+=line[1:].strip()+" "
        file.close()

lenmax=0
for e in doc.keys():
    lenmax=max(len(e),lenmax)

print "BEGIN_PROVIDER [ character*(%d), entities, (%d) ]"%(lenmax,len(doc))
print " BEGIN_DOC"
print "! List of IRP entities"
print " END_DOC"
for i,e in enumerate(doc.keys()):
    print "entities(%d) = '%s'"%(i+1,e)
print "END_PROVIDER"

for e in doc.keys():
    print "BEGIN_PROVIDER [ character*(%d), %s doc ]"%(len(doc[e]),e)
    print " BEGIN_DOC"
    print "! Documentation of variables %s"%(e,)
    print " END_DOC"
    print " %s doc = '%s'"%(e,doc[e])
    print "END_PROVIDER"

END_SHELL

